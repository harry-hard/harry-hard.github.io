<?xml version="1.0" encoding="utf-8" standalone="yes"?>
<rss version="2.0" xmlns:atom="http://www.w3.org/2005/Atom">
  <channel>
    <title>重定位的处理 :: Hacker Site</title>
    <link>http://localhost:1313/pe-loader/pe-loader/%E9%87%8D%E5%AE%9A%E4%BD%8D%E8%A1%A8%E7%9A%84%E5%A4%84%E7%90%86/index.html</link>
    <description></description>
    <generator>Hugo</generator>
    <language>en-us</language>
    <lastBuildDate>Sun, 15 Dec 2024 15:30:00 +0800</lastBuildDate>
    <atom:link href="http://localhost:1313/pe-loader/pe-loader/%E9%87%8D%E5%AE%9A%E4%BD%8D%E8%A1%A8%E7%9A%84%E5%A4%84%E7%90%86/index.xml" rel="self" type="application/rss+xml" />
    <item>
      <title>重定位表处理</title>
      <link>http://localhost:1313/pe-loader/pe-loader/%E9%87%8D%E5%AE%9A%E4%BD%8D%E8%A1%A8%E7%9A%84%E5%A4%84%E7%90%86/2-%E9%87%8D%E5%AE%9A%E4%BD%8Dpe%E6%96%87%E4%BB%B6%E7%9A%84%E9%87%8D%E5%AE%9A%E4%BD%8D%E5%9D%97%E5%92%8C%E9%87%8D%E5%AE%9A%E4%BD%8D%E9%A1%B9/index.html</link>
      <pubDate>Sun, 15 Dec 2024 15:30:00 +0800</pubDate>
      <guid>http://localhost:1313/pe-loader/pe-loader/%E9%87%8D%E5%AE%9A%E4%BD%8D%E8%A1%A8%E7%9A%84%E5%A4%84%E7%90%86/2-%E9%87%8D%E5%AE%9A%E4%BD%8Dpe%E6%96%87%E4%BB%B6%E7%9A%84%E9%87%8D%E5%AE%9A%E4%BD%8D%E5%9D%97%E5%92%8C%E9%87%8D%E5%AE%9A%E4%BD%8D%E9%A1%B9/index.html</guid>
      <description>2.重定位PE文件的重定位块和重定位项 当可执行映像加载到的地址与其首选基地址（IMAGE_OPTIONAL_HEADER.ImageBase）不同时，重定位对于调整可执行映像中的硬编码地址是必要的。在大多数情况下，PE 文件会被映射到除 IMAGE_OPTIONAL_HEADER.ImageBase 之外的地址，因此需要对 PE 文件中的某些硬编码地址进行调整。 通过计算得出地址差值：&#xA;// The difference between the current PE image base address and its preferable base address. ULONG_PTR uDeltaOffset = pPeBaseAddress - pPreferableAddress;&#xD;下面是微软SDK定义的重定位块的头部结构&#xA;typedef struct _IMAGE_BASE_RELOCATION { DWORD VirtualAddress; DWORD SizeOfBlock; } IMAGE_BASE_RELOCATION;&#xD;并没有对BASE_RELOCATION_ENTRY做出定义，但描述为：&#xA;每个重定位条目占用2字节(WORD)&#xA;每个重定位条目占用2字节(WORD) 高4位是类型(Type) 低12位是偏移量(Offset) 代码具体实现可以是：&#xA;typedef struct _BASE_RELOCATION_ENTRY { WORD&#x9;Offset&#x9;: 12; //前12字节 WORD&#x9;Type&#x9;: 4; //后4字节 //WORD总共占16位 } BASE_RELOCATION_ENTRY, * PBASE_RELOCATION_ENTRY;&#xD;IMAGE_BASE_RELOCATION和BASE_RELOCATION_ENTRY在PE文件中的位置关系是：&#xA;+——————————–+——————+——————+— | IMAGE_BASE_RELOCATION (8字节) | 重定位条目1 | 重定位条目2 | … | - VirtualAddress (4字节) | (2字节) | (2字节) | | - SizeOfBlock (4字节) | | | +—————————————-+—————-+———–+— ↑ ↑ pImgBaseRelocation pImgBaseRelocation + 1</description>
    </item>
  </channel>
</rss>